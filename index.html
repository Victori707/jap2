<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –Ø–ø–æ–Ω–∏—é</title>
  <style>
body {
  font-family: 'Roboto', 'Open Sans', Arial, sans-serif;
  background: #191620;
  margin: 0;
  color: #fff;
}
header {
  background: #ff3399;
  color: #fff;
  padding: 20px;
  text-align: center;
}
.dates {
  font-size: 1.2em;
  color: #feaad6;
}
main {
  max-width: 1100px;
  margin: 20px auto 40px auto;
  padding: 20px;
  background: #101010;
  border-radius: 14px;
  box-shadow: 0 4px 24px rgba(255,51,153,0.11);
}
.day-navigation {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding: 10px 0 15px 0;
  position: sticky;
  top: 0;
  background: #101010;
  z-index: 10;
  border-bottom: 3px solid #ff3399;
}
.day-nav-btn.active {
  background: linear-gradient(90deg,#ff3399 70%,#fe52c0 100%);
  color: #fff !important;
  border: none;
  outline: none;
  font-weight: bold;
  box-shadow: 0 2px 12px rgba(254,82,192,0.16);
  transition: background 0.2s;
}
.day-nav-btn {
  background: #101010;
  color: #ff3399;
  border: 2px solid #ff3399;
  border-radius: 7px;
  padding: 7px 13px;
  font-size: 1.06em;
  cursor: pointer;
  font-weight: bold;
  letter-spacing:1px;
  transition: background 0.2s, color 0.2s, box-shadow 0.2s;
}
.day-nav-btn:not(.active):hover {
  background: #2b2430;
  color: #fff;
  box-shadow: 0 0 14px #ff339995;
  border-color:#fe52c0;
}
footer {
  text-align: center;
  color: #feaad6;
  font-size: 0.98em;
  padding-bottom: 24px;
}
.day {
  margin-bottom: 45px;
  border-bottom: 1px solid #332537;
  padding-bottom: 36px;
}
.day-notes {
  margin-bottom: 6px;
  color: #fe52c0;
  font-size: 1.08em;
}
.day-summary {
  margin-bottom: 18px;
  color: #ffb2ec;
}
.day-content {
  display: flex;
  gap: 28px;
  align-items: flex-start;
}
.timeline-col {
  flex: 2;
  min-width: 210px;
}
.timeline-list {
  list-style: none;
  padding: 0;
  margin: 0;
  border-left: 4px solid #fe52c0;
  position: relative;
}
.timeline-event {
  position: relative;
  margin-bottom: 35px;
  padding-left: 34px;
  min-height: 36px;
  color: #fff;
  background: transparent;
  transition: background 0.22s;
  cursor: pointer;
  user-select: none;
}
.timeline-event::before {
  content: '';
  position: absolute;
  left: -11px;
  top: 7px;
  width: 18px;
  height: 18px;
  background: radial-gradient(circle,#fff 0%,#ff3399 40%); 
  border: 4px solid #fe52c0;
  box-shadow: 0 0 12px #ff3399a8, 0 2px 8px #10101044;
  border-radius: 50%;
  z-index: 1;
}
.timeline-event:hover, .timeline-event.selected {
  background: #2b1b24;
  box-shadow: 0 4px 14px #fe52c0 44, 0 1.5px 8px #10101066;
  border-left: 4.5px solid #ff3399;
  outline:1.3px solid #fe52c0aa;
  color: #ffb2ec;
}
.timeline-event time {
  font-size: 0.97em;
  color: #feaad6;
  font-weight: bold;
  margin-right: 8px;
}
.ev-note {
  margin-top: 3px;
  color: #feaad6;
  font-size: 0.97em;
}
.map-col {
  flex: 3;
  min-width: 260px;
}
.map-container {
  width: 100%;
  min-height: 220px;
  background: linear-gradient(120deg,#251c28,#32232b,#20111f 84%);
  border: 2px solid #ff339958;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #b751a7;
  font-size: 1.1em;
  margin-bottom:8px;
  opacity: 0;
  animation: fadeInMap 0.7s forwards;
  box-shadow:0 2px 13px #ff339944;
}
@keyframes fadeInMap {
  0% { opacity: 0; }
  70% { opacity: 0.4; }
  100% { opacity: 1; }
}
@media (max-width: 800px) {
  main {
    padding: 5px;
  }
  .day-content {
    flex-direction: column;
  }
  .timeline-col, .map-col {
    min-width: 180px;
    width: 100%;
  }
  .map-container {
    min-height: 165px;
  }
}
#devmode-bar {
  width: 100vw;
  background: #222026;
  padding: 8px 0 4px 0;
  text-align: right;
  z-index: 100;
}
#devmode-toggle {
  font-weight: bold;
  font-size:1.04em;
  padding: 6px 16px;
  border-radius: 7px;
  border: 2px solid #ff3399;
  margin: 0 14px;
  background: #18121e;
  color: #ff3399;
  cursor: pointer;
  transition: background 0.2s, color 0.2s, border 0.18s;
}
#devmode-toggle.dev {
  background: #ff3399;
  color: #fff;
  box-shadow: 0 2px 14px #ff339956;
  border:2px solid #fff!important;
}
#devmode-toggle:hover {
  background: #332031;
  color: #fff;
}
body.devmode [contenteditable="true"] {
  outline: 2px dashed #fe52c0;
  background: #23172a;
  border-radius: 6px;
  cursor: text;
  box-shadow: 0 0 5px #fe52c0 96;
  transition: outline 0.13s;
}
body.devmode .editable-input {
  border: 2px dashed #ff3399;
  padding: 2px 7px;
  border-radius: 7px;
  background: #232;
  color: #ffb2ec;
  font-size: 1em;
  margin-bottom: 4px;
}
body.devmode select.editable-input {
  background: #2b1c29;
  color: #ff3399;
  border-color: #fe52c0;
  cursor: pointer;
}
body.devmode select.editable-input option {
  background: #101010;
  color: #ffb2ec;
}
body.devmode .photo-upload {
  display: block;
  background: #2b1c29;
  border:1.5px solid #ff339988;
  color:#ff3399;
  margin: 7px 0 0 0;
  border-radius:8px;
  padding:6px;
  font-size: 0.99em;
  transition:background 0.15s;
}
body.devmode .photo-upload:hover {
  background: #31202a;
}
.uploaded-photo {
  max-width: 95%;
  margin: 10px 0 0 0;
  border-radius: 13px;
  border:2px solid #ff339955;
  box-shadow:0 0 12px #fe52c051;
}
.dev-photo-delete {
  color: #fff;
  background: #ff3399;
  border:none;
  padding: 4px 14px;
  border-radius:6px;
  cursor:pointer;
  font-size:0.97em;
  margin: 6px 0 0 9px;
  transition:background 0.13s;
}
.dev-photo-delete:hover {
  background: #2b1c29;
  color:#ff3399;
  border:1.5px solid #ff3399;
}
#computed-total {
  font-weight: bold;
  color: #ff3399;
  font-size: 1.1em;
}
.pulse {
  animation: pulse 0.5s ease-in-out;
}
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); color: #fe52c0; }
}
  </style>
</head>
<body>
  <div id="devmode-bar">
    <button id="devmode-toggle" onclick="toggleDevMode()">–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</button>
  </div>
  <header>
    <h1 contenteditable="false">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –Ø–ø–æ–Ω–∏—é</h1>
    <p class="dates"><span id="trip-dates"></span></p>
  </header>
  <main>
    <nav id="day-nav" class="day-navigation"></nav>
    <section id="itinerary"></section>
  </main>
  <footer>
    <div>–°–æ–∑–¥–∞—Ç–µ–ª—å: <span id="author-name">–í–∞—à–µ –ò–º—è</span>.</div>
    <div>–û–±—â–∏–π –±—é–¥–∂–µ—Ç: <span id="budget"></span></div>
    <div style="margin-top: 10px;">–ü–æ–¥—Å—á—ë—Ç –ø–æ –¥–Ω—è–º: <span id="computed-total">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
  </footer>
  <script>
    // –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ localStorage –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
    window.embeddedData = {
      "dates": "16‚Äì29 –Ω–æ—è–±—Ä—è 2025",
      "budget": "~180 000 ‚ÇΩ",
      "author": "–í–∞—à–µ –ò–º—è",
      "header": "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –Ø–ø–æ–Ω–∏—é",
      "days": [
        {
          "id": 1,
          "date": "16 –Ω–æ—è–±—Ä—è, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ",
          "title": "–í—ã–ª–µ—Ç –∏–∑ –ú–æ—Å–∫–≤—ã",
          "notes": "–í—ã–ª–µ—Ç –≤ 20:10, –±—ã—Ç—å –≤ 17:30 –≤ –®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ! –£—Ç–æ—á–Ω–∏—Ç—å –ø–æ –ø–æ–≤–æ–¥—É –±–∞–≥–∞–∂–∞! –í –∫–∏—Ç–∞–π—Å–∫–æ–º –∞—ç—Ä–æ–ø–æ—Ä—Ç—É - 4 —á–∞—Å–∞ 55 –º–∏–Ω—É—Ç. –¢—Ä–∞—Ç—ã - –Ω–µ –±–æ–ª—å—à–µ 2–∫ —Ä—É–±–ª–µ–π –Ω–∞ 1 —á–µ–ª–æ–≤–µ–∫–∞ (–∑–∞—Ä–∞–Ω–µ–µ –æ–±–º–µ–Ω—è—Ç—å –Ω–∞ —é–∞–Ω–∏!)",
          "expenses": 2000,
          "currency": "RUB",
          "timeline": [
            {"time": "17:30", "title": "–ü—Ä–∏–±—ã—Ç–∏–µ –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç", "note": "–®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, —É—Ç–æ—á–Ω–∏—Ç—å –±–∞–≥–∞–∂"},
            {"time": "20:10", "title": "–í—ã–ª–µ—Ç", "note": "–¢—Ä–∞–Ω–∑–∏—Ç –≤ –ö–∏—Ç–∞–µ 4—á 55–º, —Ç—Ä–∞—Ç—ã –¥–æ 2–∫ ‚ÇΩ (–æ–±–º–µ–Ω –Ω–∞ —é–∞–Ω–∏ –∑–∞—Ä–∞–Ω–µ–µ)"}
          ]
        },
        {
          "id": 2,
          "date": "17 –Ω–æ—è–±—Ä—è, –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
          "title": "–ü—Ä–∏–ª—ë—Ç –≤ –û—Å–∞–∫—É",
          "notes": "–ü—Ä–∏–ª—ë—Ç –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç Kansai –≤ 18:30, –∫ 20 –≤—ã–π–¥–µ–º. –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–Ω–∫–µ—Ç—É: https://services.digital.go.jp/en/visit-japan-web/ –í –∞—ç—Ä–æ–ø–æ—Ä—Ç—É –ø–æ–∫—É–ø–∞–µ–º —Å–∏–º–∫—É - –¥–æ 5–∫ —Ä—É–±–ª–µ–π –Ω–∞ 1 —á–µ–ª–æ–≤–µ–∫–∞. –ü–æ–µ–∑–¥ –¥–æ Namba Station (970 ¬•). –î–æ 22:00 –∑–∞—Å–µ–ª–µ–Ω–∏–µ –≤ –æ—Ç–µ–ª—å Blue Motomachi.",
          "expenses": 5000,
          "currency": "RUB",
          "timeline": [
            {"time": "18:30", "title": "–ü—Ä–∏–ª—ë—Ç –≤ Kansai", "note": "–ê—ç—Ä–æ–ø–æ—Ä—Ç –û—Å–∞–∫–∏, –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É –∑–∞—Ä–∞–Ω–µ–µ", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Kansai+Airport"}},
            {"time": "20:00", "title": "–ü–æ–µ–∑–¥ –¥–æ Namba Station", "note": "970 ¬•, –≤—Ä–µ–º—è: 19:43, 19:54, 20:14", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Namba+Station+Osaka"}},
            {"time": "22:00", "title": "–ó–∞—Å–µ–ª–µ–Ω–∏–µ –≤ –æ—Ç–µ–ª—å", "note": "Blue Motomachi, 2 Chome-13-19 Motomachi, —É–∂–∏–Ω –≤ –∫–æ–Ω–±–∏–Ω–∏", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Blue+Motomachi+Osaka"}}
          ]
        },
        {
          "id": 3,
          "date": "18 –Ω–æ—è–±—Ä—è, –≤—Ç–æ—Ä–Ω–∏–∫",
          "title": "–û—Å–∞–∫–∞ –¥–µ–Ω—å 1",
          "notes": "–ù–∞–¥–æ –∫—É–ø–∏—Ç—å –±–∏–ª–µ—Ç—ã (7–∫ ¬•). –•—Ä–∞–º—ã, –ø–∞—Ä–∫–∏, –æ–∫–µ–∞–Ω–∞—Ä–∏—É–º (1,4–∫ ‚ÇΩ –∑–∞—Ä–∞–Ω–µ–µ!), –î–æ—Ç–æ–Ω–±–æ—Ä–∏. –ü—Ä–æ–µ–∑–¥–Ω–æ–π 900 ¬•, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—É–∏–∫–∏ 250 ¬•.",
          "expenses": 13000,
          "currency": "JPY",
          "timeline": [
            {"time": "9:30", "title": "–•—Ä–∞–º –ù–∞–º–±–∞", "note": "2 Chome-9-19 Motomachi, –∑–∞–≤—Ç—Ä–∞–∫ –≤ –∫–æ–Ω–±–∏–Ω–∏ –¥–æ 1–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/2+Chome-9-19+Motomachi+Naniwa+Ward+Osaka"}},
            {"time": "10:00", "title": "–ù–∞–º–±–∞ –ø–∞—Ä–∫—Å", "note": "2 Chome-10-70 Nanbanaka", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Namba+Parks+Osaka"}},
            {"time": "10:40", "title": "–°–∏—Ç—Ç—ç–Ω –Ω–æ –¥–∂–∏", "note": "1 Chome-11-18 Shitennoji", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Shitennoji+Temple+Osaka"}},
            {"time": "11:20", "title": "–ö—ç–π—Ç–∞–∫—É—ç–Ω", "note": "300 ¬•, Chausuyamacho 1", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Keitakuen+Garden+Osaka"}},
            {"time": "13:00", "title": "–°—É–π—ë—Å–∏ –¢–∞–π—Å—è", "note": "2 Chome-9-89 Sumiyoshi, –æ–±–µ–¥ –¥–æ 1,5–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Sumiyoshi+Taisha+Osaka"}},
            {"time": "15:15", "title": "–û–∫–µ–∞–Ω–∞—Ä–∏—É–º", "note": "1,4–∫ ‚ÇΩ –∑–∞—Ä–∞–Ω–µ–µ! 1 Chome-1-10 Kaigandori", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Osaka+Aquarium+Kaiyukan"}},
            {"time": "18:00", "title": "–î–æ—Ç–æ–Ω–±–æ—Ä–∏", "note": "–í–µ—Å—å –≤–µ—á–µ—Ä, –ú–∏–¥–æ–°—É–¥–∂–∏, Donguri Kyowakoku, —É–∂–∏–Ω 2–∫ ¬•, –≤–æ–∑–º–æ–∂–Ω–æ Nipponbashi –¥–æ 19:00", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Dotonbori+Osaka"}}
          ]
        },
        {
          "id": 4,
          "date": "19 –Ω–æ—è–±—Ä—è, —Å—Ä–µ–¥–∞",
          "title": "–û—Å–∞–∫–∞ –¥–µ–Ω—å 2",
          "notes": "–ù–∞—Ä—É—Ç–æ –ø–∞—Ä–∫, –º—É–∑–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –û—Å–∞–∫–∏, –∑–∞–º–æ–∫ –û—Å–∞–∫–∏, –¶—É—Ç–µ–Ω—Ç–∞–∫—É. –ü—Ä–æ–µ–∑–¥–Ω–æ–π 900 ¬•.",
          "expenses": 6600,
          "currency": "JPY",
          "timeline": [
            {"time": "8:30", "title": "–í—ã—Ö–æ–¥", "note": "–ü–µ—Ä–µ–∫—É—Å 700 ¬•"},
            {"time": "8:50", "title": "Osaka Station", "note": "–ë—ã—Ç—å –Ω–∞ —Å—Ç–∞–Ω—Ü–∏–∏"},
            {"time": "10:34", "title": "–ù–∞—Ä—É—Ç–æ –ø–∞—Ä–∫", "note": "–ü—Ä–∏–±—ã—Ç–∏–µ", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Naruto+Park+Osaka"}},
            {"time": "13:34", "title": "–ú—É–∑–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –û—Å–∞–∫–∏", "note": "1–∫ ¬• + –æ–±–µ–¥ 1,5–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Osaka+Museum+of+History"}},
            {"time": "15:40", "title": "–ú—É–∑–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –û—Å–∞–∫–∏", "note": "4 Chome-1-32 Otemae, 1–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Osaka+Museum+of+History"}},
            {"time": "17:00", "title": "–ó–∞–º–æ–∫ –û—Å–∞–∫–∏", "note": "1-1 Osakajo", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Osaka+Castle"}},
            {"time": "19:00", "title": "–¶—É—Ç–µ–Ω—Ç–∞–∫—É", "note": "–£–∂–∏–Ω 1,5–∫ ¬•, 1 Chome-18-6 Ebisuhigashi", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Tsutenkaku+Osaka"}}
          ]
        },
        {
          "id": 5,
          "date": "20 –Ω–æ—è–±—Ä—è, —á–µ—Ç–≤–µ—Ä–≥",
          "title": "–û—Å–∞–∫–∞ - –ö–∏–æ—Ç–æ –¥–µ–Ω—å 3",
          "notes": "–ö–∞—Ç—Å—É–æ –î–∂–∏, –ù–∞—Ä–∞ (–æ–ª–µ–Ω–∏, —Ö—Ä–∞–º—ã), –ø–µ—Ä–µ–µ–∑–¥ –≤ –ö–∏–æ—Ç–æ. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–µ—â–µ–π –≤ –ö–∏–æ—Ç–æ 2,4–∫ ¬•. –£–∂–∏–Ω –≤ –∫–æ–Ω–±–∏–Ω–∏ 800 ¬•.",
          "expenses": 18000,
          "currency": "JPY",
          "timeline": [
            {"time": "7:00", "title": "–í—ã—Ö–æ–¥", "note": "–ó–∞–≤—Ç—Ä–∞–∫ 2–∫ ¬• –Ω–∞ –≤—Å–µ—Ö, –≤—ã—Å–µ–ª–µ–Ω–∏–µ, –≤–µ—â–∏ –≤ –ö–∏–æ—Ç–æ 2,4–∫ ¬•"},
            {"time": "8:10", "title": "–ö–∞—Ç—Å—É–æ –î–∂–∏", "note": "2914-1 Aomatani, Minoh, —Ç–∞–∫—Å–∏ 3430 ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Katsuo-ji+Temple"}},
            {"time": "9:40", "title": "–í—ã–µ–∑–¥ –≤ –û—Å–∞–∫—É", "note": "–û–±—Ä–∞—Ç–Ω—ã–π –ø—É—Ç—å"},
            {"time": "11:00", "title": "–í—ã–µ–∑–¥ –≤ –ù–∞—Ä—É", "note": "600 ¬•"},
            {"time": "12:00", "title": "–ü—Ä–∏–±—ã—Ç–∏–µ –≤ –ù–∞—Ä—É", "note": "–ü–µ—Ä–µ–∫—É—Å Nakatanidou + –ö–æ—Ñ—É–∫—É-–¥–∂–∏ 1,5–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Nara+Park"}},
            {"time": "12:50", "title": "–ü–∞–≤–∏–ª—å–æ–Ω", "note": "Takabatakecho", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Nara+Park"}},
            {"time": "13:20", "title": "–ö–∞—Å—É–≥–∞ —Ç–∞–π—Å—è", "note": "700 ¬•, 160 Kasuganocho", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Kasuga+Taisha+Nara"}},
            {"time": "14:00", "title": "–¢–æ–¥–∞–π –¥–∂–∏", "note": "1–∫ ¬•, 406-1 Zoshicho", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Todai-ji+Temple+Nara"}},
            {"time": "14:40", "title": "–ü–∞—Ä–∫ —Å –æ–ª–µ–Ω—è–º–∏", "note": "–û–±–µ–¥ –¥–æ 15:20, 2,5–∫ ¬•, 1 —á–∞—Å —Å –æ–ª–µ–Ω—è–º–∏", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Nara+Park"}},
            {"time": "18:30", "title": "–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –ö–∏–æ—Ç–æ", "note": "1,6–∫ ¬•"},
            {"time": "20:00", "title": "–ü—Ä–∏–±—ã—Ç–∏–µ –≤ –ö–∏–æ—Ç–æ", "note": "–û—Ç–µ–ª—å Stay Sakura Hotel, –∑–∞—Å–µ–ª–µ–Ω–∏–µ –¥–æ 21, 1800 ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Stay+Sakura+Hotel+Kyoto"}}
          ]
        },
        {
          "id": 6,
          "date": "21 –Ω–æ—è–±—Ä—è, –ø—è—Ç–Ω–∏—Ü–∞",
          "title": "–ö–∏–æ—Ç–æ –¥–µ–Ω—å 1",
          "notes": "–õ–µ—Å –ê—Ä–∞—à–∏—è–º–∞, –¢–µ–Ω—Ä—é –¥–∂–∏, –≥–∞–ª–µ—Ä–µ—è, —Ö—Ä–∞–º –•—ç–π–∞–Ω, –ø–∞—Ä–∫ –ì–∏–æ–Ω, –∑–∞–º–æ–∫ –ù–∏–¥–∑–æ. –ü—Ä–æ–µ–∑–¥–Ω–æ–π 1,1–∫ ¬•.",
          "expenses": 8000,
          "currency": "JPY",
          "timeline": [
            {"time": "7:40", "title": "–í—ã—Ö–æ–¥", "note": "Tambaguchi Station ‚Üí Saga-Arashiyama Station, –ø–µ—Ä–µ–∫—É—Å 700 ¬•"},
            {"time": "8:50", "title": "–õ–µ—Å –ê—Ä–∞—à–∏—è–º–∞", "note": "Sagaogurayama Tabuchiyamacho", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Arashiyama+Bamboo+Grove"}},
            {"time": "8:50", "title": "–¢–µ–Ω—Ä—é –¥–∂–∏", "note": "800 ¬•, Sagatenryuji Susukinobabacho 68", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Tenryu-ji+Temple"}},
            {"time": "10:00", "title": "–ì–∞–ª–µ—Ä–µ—è", "note": "2,3–∫ ¬•, 6 Sagakamenoocho", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Arashiyama"}},
            {"time": "14:00", "title": "–•—Ä–∞–º –•—ç–π–∞–Ω", "note": "97 Okazaki Nishitennocho, –ø–µ—Ä–µ–∫—É—Å 1–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Heian+Shrine+Kyoto"}},
            {"time": "15:20", "title": "–ü–∞—Ä–∫ –ì–∏–æ–Ω", "note": "3 Kyotogyoen, 30–º –ø–µ—à–∫–æ–º", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Kyoto+Gyoen+National+Garden"}},
            {"time": "16:30", "title": "–ó–∞–º–æ–∫ –ù–∏–¥–∑–æ", "note": "800 ¬• –µ—Å–ª–∏ —Ö–æ—Ç–∏–º, –¥–æ 17", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Nijo+Castle+Kyoto"}}
          ]
        },
        {
          "id": 7,
          "date": "22 –Ω–æ—è–±—Ä—è, —Å—É–±–±–æ—Ç–∞",
          "title": "–ö–∏–æ—Ç–æ –¥–µ–Ω—å 2",
          "notes": "–ü–∞–≥–æ–¥–∞ –Ø—Å–∞–∫–∞, –ö–∏—ë—É–º–∏–¥–∑—É –¥—ç—Ä–∞, –°—ç–Ω–Ω—é –¥–∂–∏, —Ç–æ—Ñ–æ–∫—É –¥–∂–∏, –§—É—Å–∏–º–∏ –ò–Ω–∞—Ä–∏ (–∫–∏–º–æ–Ω–æ 5–∫ ¬•), –•–∏—Ä–æ–±—É–Ω. –ü—Ä–æ–µ–∑–¥–Ω–æ–π 1,1–∫ ¬•.",
          "expenses": 8000,
          "currency": "JPY",
          "timeline": [
            {"time": "6:30", "title": "–í—ã—Ö–æ–¥", "note": "–ê–≤—Ç–æ–±—É—Å 30 –º–∏–Ω –¥–æ –ü–∞–≥–æ–¥—ã –Ø—Å–∞–∫–∞"},
            {"time": "7:30", "title": "–ö–∏—ë—É–º–∏–¥–∑—É –¥—ç—Ä–∞", "note": "1–∫ ¬•, 1 Chome-294 Kiyomizu, –¥–æ 8:10", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Kiyomizu-dera+Temple"}},
            {"time": "9:00", "title": "–°—ç–Ω–Ω—é –¥–∂–∏", "note": "500 ¬•, 27 Sennyuji Yamanouchicho, 45–º", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Sennyu-ji+Temple"}},
            {"time": "9:30", "title": "–¢–æ—Ñ–æ–∫—É –¥–∂–∏", "note": "600 ¬•, 15 Chome-778 Honmachi", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Tofuku-ji+Temple"}},
            {"time": "9:50", "title": "–§—É—Å–∏–º–∏ –ò–Ω–∞—Ä–∏", "note": "–ó–∞–≤—Ç—Ä–∞–∫ 1–∫ ¬•, –∫–∏–º–æ–Ω–æ 5–∫ ¬•, 68 Fukakusa Yabunouchicho", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Fushimi+Inari+Shrine"}},
            {"time": "12:00", "title": "–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –•–∏—Ä–æ–±—É–Ω", "note": "1—á –Ω–∞ –º–µ—Ç—Ä–æ, 30–º –ø–µ—à–∫–æ–º"},
            {"time": "14:00", "title": "–û–±–µ–¥ –≤ –•–∏—Ä–æ–±—É–Ω", "note": "2–∫ ¬•, 87 Kuramakibunecho", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Kurama+Hirobun"}},
            {"time": "18:00", "title": "–û–±—Ä–∞—Ç–Ω–æ –≤ –ö–∏–æ—Ç–æ", "note": "–¢–µ–º –∂–µ –ø—É—Ç—ë–º"},
            {"time": "20:00", "title": "–ü—Ä–∏–±—ã—Ç–∏–µ –≤ –ö–∏–æ—Ç–æ", "note": "–£–∂–∏–Ω/—Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è 1–∫ ¬•"}
          ]
        },
        {
          "id": 8,
          "date": "23 –Ω–æ—è–±—Ä—è, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ",
          "title": "–ö–∏–æ—Ç–æ –¥–µ–Ω—å 3 - –¢–æ–∫–∏–æ",
          "notes": "–í—ã—Å–µ–ª–µ–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤–µ—â–µ–π (2,5–∫ ¬•), —Ö—Ä–∞–º –¢–æ –¥–∂–∏, –ø–æ–µ–∑–¥ –≤ –¢–æ–∫–∏–æ (8,5–∫ ‚ÇΩ –∑–∞—Ä–∞–Ω–µ–µ, –¥–æ—Ä–æ–∂ –±—ç–Ω—Ç–æ 1,5–∫ ¬•), –∑–∞–º–æ–∫ –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞, –•–∏–µ —à–∏–Ω—Ä–µ, –º—É–∑–µ–π, –ì–∏–Ω–∑–∞. –ü—Ä–æ–µ–∑–¥–Ω–æ–π –Ω–∞ 3 –¥–Ω—è 1,5–∫ ¬•.",
          "expenses": 10700,
          "currency": "RUB",
          "timeline": [
            {"time": "9:00", "title": "–í—ã—Å–µ–ª–µ–Ω–∏–µ", "note": "–û—Ç–ø—Ä–∞–≤–∫–∞ –≤–µ—â–µ–π 2,5–∫ ¬•, –∑–∞–≤—Ç—Ä–∞–∫ –≤ –∞–æ–π—Ç–æ—Ä–∏ 1–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Aoitori+Kyoto"}},
            {"time": "9:50", "title": "–•—Ä–∞–º –¢–æ –¥–∂–∏", "note": "1–∫ ¬•, 1 Kujocho", "location": {"mapsUrl": "https://maps.app.goo.gl/search/To-ji+Temple+Kyoto"}},
            {"time": "11:00", "title": "–ü–æ–µ–∑–¥ –≤ –¢–æ–∫–∏–æ", "note": "8,5–∫ ‚ÇΩ –∑–∞—Ä–∞–Ω–µ–µ!, –¥–æ—Ä–æ–∂ –±—ç–Ω—Ç–æ 1,5–∫ ¬•"},
            {"time": "13:30", "title": "–°—Ç–∞–Ω—Ü–∏—è –¢–æ–∫–∏–æ", "note": "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—É–≤–µ–Ω–∏—Ä—á–∏–∫"},
            {"time": "14:00", "title": "–ó–∞–º–æ–∫ –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞", "note": "1-1 Chiyoda, –¥–æ 15:30", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Imperial+Palace+Tokyo"}},
            {"time": "16:00", "title": "–•–∏–µ —à–∏–Ω—Ä–µ", "note": "2 Chome-10-5 Nagatach≈ç", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Hie+Shrine+Tokyo"}},
            {"time": "17:00", "title": "–ú—É–∑–µ–π", "note": "2,2–∫ ‚ÇΩ, –¥–æ 19, 5 Chome‚àíÔºô Azabudai Hills", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Azabudai+Hills+Tokyo"}},
            {"time": "19:40", "title": "–ì–∏–Ω–∑–∞", "note": "–ü–µ—Ä–µ–∫—É—Å 800 ¬•, 6 Chome-10-1 Ginza", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Ginza+Tokyo"}},
            {"time": "21:00", "title": "–û—Ç–µ–ª—å", "note": "Marvelous Asakusa, 4-ch≈çme-43-7 Asakusa", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Marvelous+Asakusa"}}
          ]
        },
        {
          "id": 9,
          "date": "24 –Ω–æ—è–±—Ä—è, –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
          "title": "–¢–æ–∫–∏–æ –¥–µ–Ω—å 2",
          "notes": "–ì–æ—Ç–æ–∫—É –î–∂–∏, –ú—ç–π–¥–∑–∏, –•–∞—Ä–∞–¥–∑—é–∫—É, –°–∏–±—É—è, –º—É–∑–µ–π. –£–∂–∏–Ω 1–∫ ¬•.",
          "expenses": 1000,
          "currency": "RUB",
          "timeline": [
            {"time": "7:00", "title": "–í—ã—Ö–æ–¥", "note": "–ü–µ—Ä–µ–∫—É—Å 500 ¬•, –º–µ—Ç—Ä–æ 1,5 —á–∞—Å–∞ –æ—Ç –ê—Å–∞–∫—É—Å–∞"},
            {"time": "8:30", "title": "–ì–æ—Ç–æ–∫—É –î–∂–∏", "note": "500 ¬•, 2 Chome-24-7 Gotokuji", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Gotokuji+Temple"}},
            {"time": "9:50", "title": "–ú—ç–π–¥–∑–∏", "note": "1-1 Yoyogikamizonocho, –¥–æ 11:00", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Meiji+Shrine+Tokyo"}},
            {"time": "11:30", "title": "–•–∞—Ä–∞–¥–∑—é–∫—É", "note": "–®–æ–ø–ø–∏–Ω–≥ 45 –º–∏–Ω, –î–∑–∏–Ω–≥—É–º–∞—ç", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Harajuku+Tokyo"}},
            {"time": "13:30", "title": "–°–∏–±—É—è", "note": "–•–∞—Ç–∏–∫–æ, –∫–∞—Ñ–µ SAKURA SIDE 1,5–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Shibuya+Tokyo"}},
            {"time": "16:00", "title": "–ú—É–∑–µ–π", "note": "1–∫ ‚ÇΩ, 7 Chome-22-2 Roppongi", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Roppongi+Tokyo"}},
            {"time": "18:00", "title": "–¢–æ–∫–∏–π—Å–∫–∞—è —Ç–µ–ª–µ–±–∞—à–Ω—è", "note": "–ò–ª–∏ –Ω–æ—á–Ω–æ–π —Ä–∞–π–æ–Ω, —É–∂–∏–Ω 1–∫ ¬•, –¥–æ—Ä–æ–≥–∞ –¥–æ–º–æ–π 1—á –º–µ—Ç—Ä–æ", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Tokyo+Tower"}}
          ]
        },
        {
          "id": 10,
          "date": "25 –Ω–æ—è–±—Ä—è, –≤—Ç–æ—Ä–Ω–∏–∫",
          "title": "–¢–æ–∫–∏–æ –¥–µ–Ω—å 3 - –ö–∞–º–∞–∫—É—Ä–∞",
          "notes": "–ö–æ—Ç–æ–∫—É –ò–Ω, –•–∞—Å–µ–¥–µ—Ä–∞, –∫–æ—à–∏–≥–æ–µ, Donguri Kyowakoku, —É–ª–∏—Ü–∞ –ö–æ–º–∞—á–∏, –•–æ–∫–æ–∫—É –¥–∂–∏, –ê–∫–∏—Ö–∞–±–∞—Ä–∞, –£–µ–Ω–æ. –£–∂–∏–Ω 1,5–∫ ¬•.",
          "expenses": 6160,
          "currency": "JPY",
          "timeline": [
            {"time": "8:00", "title": "–í—ã—Ö–æ–¥", "note": "–ü–µ—Ä–µ–∫—É—Å 600 ¬•"},
            {"time": "8:08", "title": "–î–æ—Ä–æ–≥–∞ –¥–æ Kamakura", "note": "1–∫ ¬•, –ø—Ä–∏–±—ã—Ç–∏–µ 9:45"},
            {"time": "10:20", "title": "–ö–æ—Ç–æ–∫—É –ò–Ω", "note": "300 ¬•, 4 Chome-2-28 Hase", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Kotoku-in+Kamakura"}},
            {"time": "11:00", "title": "–•–∞—Å–µ–¥–µ—Ä–∞", "note": "400 ¬•, 4 Chome-2-28 Hase", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Hase-dera+Kamakura"}},
            {"time": "12:00", "title": "–ö–æ—à–∏–≥–æ–µ", "note": "1 Chome-1 Koshigoe", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Koshigoe+Kamakura"}},
            {"time": "12:40", "title": "Donguri Kyowakoku", "note": "–û–±–µ–¥ 1,3–∫ ¬•, —É–ª–∏—Ü–∞ –ö–æ–º–∞—á–∏, –¥–æ 14:20", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Komachi+Street+Kamakura"}},
            {"time": "14:50", "title": "–•–æ–∫–æ–∫—É –¥–∂–∏", "note": "400 ¬•, –¥–æ 16, 2 Chome-7-4 Jomyoji", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Hokoku-ji+Temple"}},
            {"time": "17:00", "title": "–ê–∫–∏—Ö–∞–±–∞—Ä–∞ / –£–µ–Ω–æ", "note": "–ì—É–ª—è–µ–º, —É–∂–∏–Ω 1,5–∫ ¬•, –¥–æ—Ä–æ–≥–∞ 1–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Akihabara+Tokyo"}}
          ]
        },
        {
          "id": 11,
          "date": "26 –Ω–æ—è–±—Ä—è, —Å—Ä–µ–¥–∞",
          "title": "–¢–æ–∫–∏–æ –¥–µ–Ω—å 4 - –•–∞–∫–æ–Ω–µ",
          "notes": "–°–≤–æ–±–æ–¥–Ω—ã–π –¥–µ–Ω—å –í–∏–∫–∏. –í—ã—Å–µ–ª–µ–Ω–∏–µ, –≤–µ—â–∏ –≤ –∫–∞–º–µ—Ä—É —Ö—Ä–∞–Ω–µ–Ω–∏—è 2–∫ ¬•. –°—ç–Ω—Å–æ–¥–∂–∏, –¢—Å—É–∫–∏–¥–∂–∏, –ö–æ–∏—à–∏–∫–∞–≤–∞ –∫–æ–∫–∞–∫—É—Ä—ç–Ω. –í 14:30 –±—ã—Ç—å –Ω–∞ —Å—Ç–∞–Ω—Ü–∏–∏ Shunjuku! Hakone free pass 7,6–∫ ¬•, –±–∏–ª–µ—Ç –Ω–∞ –ø–æ–µ–∑–¥ 1,7–∫ ¬•. –ü–æ–µ–∑–¥ 15:00!",
          "expenses": 16000,
          "currency": "JPY",
          "timeline": [
            {"time": "9:00", "title": "–í—ã—Ö–æ–¥", "note": "–ó–∞–≤—Ç—Ä–∞–∫ 2–∫ ¬• –ø–æ –ø—É—Ç–∏ –≤ —Ö—Ä–∞–º"},
            {"time": "9:40", "title": "–°—ç–Ω—Å–æ–¥–∂–∏", "note": "2 Chome-3-1 Asakusa, –¥–æ 11:00, –∫–∞–º–∏–Ω–∞—Ä–∏ –ú–æ–Ω", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Senso-ji+Temple"}},
            {"time": "11:30", "title": "–¢—Å—É–∫–∏–¥–∂–∏", "note": "–†—ã–Ω–æ–∫ –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç–æ–≤, 1,5–∫ ¬•, 4 Chome Tsukiji", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Tsukiji+Fish+Market"}},
            {"time": "12:50", "title": "–ö–æ–∏—à–∏–∫–∞–≤–∞ –∫–æ–∫–∞–∫—É—Ä—ç–Ω", "note": "300 ¬•, –¥–æ 14:10, 1 Chome-6-6 Koraku", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Koishikawa+Korakuen"}},
            {"time": "14:30", "title": "–°—Ç–∞–Ω—Ü–∏—è Shunjuku", "note": "–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û! Hakone free pass 7,6–∫ ¬•, –±–∏–ª–µ—Ç 1,7–∫ ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Shinjuku+Station"}},
            {"time": "15:00", "title": "–ü–û–ï–ó–î", "note": "–ö–¢–û –û–ü–û–ó–î–ê–ï–¢ –û–°–¢–ê–ï–¢–°–Ø –í –¢–û–ö–ò–û!"},
            {"time": "17:40", "title": "–ó–∞—Å–µ–ª–µ–Ω–∏–µ –≤ –æ—Ç–µ–ª—å", "note": "Senkyoro, 1284 Sengokuhara, 450 ¬•", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Senkyoro+Hakone"}}
          ]
        },
        {
          "id": 12,
          "date": "27 –Ω–æ—è–±—Ä—è, —á–µ—Ç–≤–µ—Ä–≥",
          "title": "–•–∞–∫–æ–Ω–µ - –¢–æ–∫–∏–æ –¥–µ–Ω—å 5",
          "notes": "–ü–æ–ª–µ Sengokuhara, —Å–∞–¥—ã –∏ –º—É–∑–µ–π —Å—Ç–µ–∫–ª–∞, –∫–∞–Ω–∞—Ç–Ω–∞—è –¥–æ—Ä–æ–≥–∞, –û–≤–∞–∫—É–¥–∞–Ω–∏, –∫–æ—Ä–∞–±–ª—å, —Ç–æ–æ—Ä–∏ –Ω–∞ –≤–æ–¥–µ. –ë–∏–ª–µ—Ç 1,7–∫ ¬•. –ü—Ä–æ–µ–∑–¥–Ω–æ–π 1 –¥–µ–Ω—å 800 ¬•.",
          "expenses": 7000,
          "currency": "JPY",
          "timeline": [
            {"time": "9:00", "title": "–í—ã—Å–µ–ª–µ–Ω–∏–µ", "note": "–ü–æ–ª–µ Sengokuhara"},
            {"time": "9:50", "title": "–ù–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫—É", "note": "–ö –ø–æ–ª—é"},
            {"time": "10:20", "title": "–°–∞–¥—ã –∏ –º—É–∑–µ–π —Å—Ç–µ–∫–ª–∞", "note": "1,4–∫ ¬•, 1300 Gora", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Hakone+Glass+Museum"}},
            {"time": "11:20", "title": "–ö–∞–Ω–∞—Ç–Ω–∞—è –¥–æ—Ä–æ–≥–∞", "note": "–ì–æ—Ä–∞, –û–≤–∞–∫—É–¥–∞–Ω–∏", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Owakudani+Hakone"}},
            {"time": "12:30", "title": "–ö–æ—Ä–∞–±–ª—å", "note": "–û–±–µ–¥ 1–∫ ¬•, –¥–æ 13:40"},
            {"time": "14:40", "title": "–¢–æ–æ—Ä–∏ –Ω–∞ –≤–æ–¥–µ", "note": "80-1 Motohakone", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Hakone+Shrine"}},
            {"time": "16:40", "title": "–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞", "note": "1,7–∫ ¬•"},
            {"time": "18:30", "title": "–ü—Ä–∏–±—ã—Ç–∏–µ –≤ –¢–æ–∫–∏–æ", "note": "–û—Ç–µ–ª—å Pod Select Hotel Tokyo Shinjuku", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Pod+Select+Hotel+Tokyo+Shinjuku"}},
            {"time": "20:00", "title": "–£–∂–∏–Ω", "note": "2–∫ ¬•, –°–∏–Ω–¥–∑—é–∫—É"}
          ]
        },
        {
          "id": 13,
          "date": "28 –Ω–æ—è–±—Ä—è, –ø—è—Ç–Ω–∏—Ü–∞",
          "title": "–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å",
          "notes": "–°–∏–Ω–¥–∑—É–∫—É-–≥—ë—ç–Ω (500 ¬•), –°—Ç–∞—Ä–±–∞–∫—Å, –∑–∞–≤—Ç—Ä–∞–∫ –∏ –µ–¥–∞ –≤ —Å–∞–º–æ–ª—ë—Ç 4–∫ ¬•. –í 11:50 –±—ã—Ç—å –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç—É –ù–∞—Ä–∏—Ç–∞ (1–∫ ¬•). 19 —á–∞—Å–æ–≤ –ø–µ—Ä–µ—Å–∞–¥–∫–∞ –≤ –ö–∏—Ç–∞–µ (10–∫ ‚ÇΩ - –ø–æ–º–µ–Ω—è—Ç—å –≤ —é–∞–Ω–∏!). –ü–µ—Ä–µ–æ—Ñ–æ—Ä–º–∏—Ç—å –±–∞–≥–∞–∂!",
          "expenses": 10000,
          "currency": "RUB",
          "timeline": [
            {"time": "9:00", "title": "–°–∏–Ω–¥–∑—É–∫—É-–≥—ë—ç–Ω", "note": "500 ¬•, 11 Naitomachi, –°—Ç–∞—Ä–±–∞–∫—Å", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Shinjuku+Gyoen"}},
            {"time": "10:10", "title": "–í—ã—Å–µ–ª–µ–Ω–∏–µ", "note": "–ò–¥—ë–º –Ω–∞ —Å—Ç–∞–Ω—Ü–∏—é"},
            {"time": "11:50", "title": "–ê—ç—Ä–æ–ø–æ—Ä—Ç –ù–∞—Ä–∏—Ç–∞", "note": "1–∫ ¬•, –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!", "location": {"mapsUrl": "https://maps.app.goo.gl/search/Narita+Airport"}},
            {"time": "29.11 18:40", "title": "–ú–æ—Å–∫–≤–∞", "note": "–ü—Ä–∏–ª—ë—Ç, –∫ 19:30 –≤—ã–π–¥–µ–º –∏–∑ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞"}
          ]
        }
      ]
    };
  </script>
  <script>
// script.js - –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—Å—Ç—Ä–æ–µ–Ω

let daysData = [];
let tripDataRaw = null;
let isDevMode = false;
const RATE_JPY_TO_RUB = 0.68;

function formatRub(n) {
  const num = Number(n || 0);
  return num.toLocaleString('ru-RU');
}
function coerceExpense(v) {
  if (typeof v === 'number') return v;
  if (!v) return 0;
  const digits = String(v).replace(/[^0-9]/g, '');
  return digits ? Number(digits) : 0;
}

function loadData() {
  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–Ω–∏)
  if (window.embeddedData && typeof window.embeddedData === 'object') {
    if (window.embeddedData.days && Array.isArray(window.embeddedData.days) && window.embeddedData.days.length > 0) {
      return Promise.resolve(window.embeddedData);
    }
  }
  // –ó–∞—Ç–µ–º localStorage (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  const ls = localStorage.getItem('jp_itin_v1');
  if (ls) {
    try {
      const parsed = JSON.parse(ls);
      if (parsed && typeof parsed === 'object') {
        if (!parsed.days) parsed.days = [];
        // –ï—Å–ª–∏ –≤ localStorage –µ—Å—Ç—å –¥–Ω–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
        if (parsed.days.length > 0) {
          return Promise.resolve(parsed);
        }
      }
    } catch(e) {
      console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ localStorage:', e);
    }
  }
  // –ï—Å–ª–∏ –≤ localStorage –Ω–µ—Ç –¥–Ω–µ–π, –Ω–æ –µ—Å—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
  if (window.embeddedData && typeof window.embeddedData === 'object') {
    if (!window.embeddedData.days) window.embeddedData.days = [];
    return Promise.resolve(window.embeddedData);
  }
  // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  return Promise.resolve({
    "dates": "16‚Äì29 –Ω–æ—è–±—Ä—è 2025",
    "budget": "~180 000 ‚ÇΩ",
    "author": "–í–∞—à–µ –ò–º—è",
    "header": "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –Ø–ø–æ–Ω–∏—é",
    "days": []
  });
}

function saveData(data) {
  localStorage.setItem('jp_itin_v1', JSON.stringify(data));
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  window.embeddedData = data;
}

function computeAndRenderTotals() {
  if (!daysData || daysData.length === 0) {
    const totalEl = document.getElementById('computed-total');
    if (totalEl) totalEl.textContent = '0 ‚ÇΩ';
    return;
  }
  let totalRUB = 0;
  let totalJPY = 0;
  daysData.forEach(day => {
    const exp = coerceExpense(day.expenses);
    const currency = day.currency || 'RUB';
    if (currency === 'JPY') {
      totalJPY += exp;
    } else {
      totalRUB += exp;
    }
  });
  const jpyInRub = totalJPY * RATE_JPY_TO_RUB;
  const grandTotal = totalRUB + jpyInRub;
  const totalEl = document.getElementById('computed-total');
  if (totalEl) {
    let text = `${formatRub(Math.round(grandTotal))} ‚ÇΩ`;
    if (totalJPY > 0) {
      text += ` (${formatRub(totalJPY)} ¬• = ${formatRub(Math.round(jpyInRub))} ‚ÇΩ –ø–æ –∫—É—Ä—Å—É ${RATE_JPY_TO_RUB} + ${formatRub(totalRUB)} ‚ÇΩ)`;
    }
    totalEl.textContent = text;
    totalEl.classList.add('pulse');
    setTimeout(() => totalEl.classList.remove('pulse'), 500);
  }
}

function setDevMode(state) {
  isDevMode = !!state;
  document.body.classList.toggle('devmode', isDevMode);
  const btn = document.getElementById('devmode-toggle');
  if (btn) {
    btn.classList.toggle('dev', isDevMode);
    btn.textContent = isDevMode ? '–í—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞' : '–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞';
  }
  const devBar = document.getElementById('devmode-bar');
  if (devBar) {
    let saveBtn = document.getElementById('save-plan-btn');
    let saveHtmlBtn = document.getElementById('save-html-btn');
    if (isDevMode) {
      if (!saveBtn) {
        saveBtn = document.createElement('button');
        saveBtn.id = 'save-plan-btn';
        saveBtn.textContent = 'üìù –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω';
        saveBtn.style.cssText = 'margin-left: 10px; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
        saveBtn.onclick = savePlanToServer;
        devBar.appendChild(saveBtn);
      }
      if (!saveHtmlBtn) {
        saveHtmlBtn = document.createElement('button');
        saveHtmlBtn.id = 'save-html-btn';
        saveHtmlBtn.textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å HTML';
        saveHtmlBtn.style.cssText = 'margin-left: 10px; padding: 8px 16px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;';
        saveHtmlBtn.onclick = saveHTMLToFile;
        devBar.appendChild(saveHtmlBtn);
      }
    } else {
      if (saveBtn) saveBtn.remove();
      if (saveHtmlBtn) saveHtmlBtn.remove();
    }
  }
  renderTripInfo(tripDataRaw);
  renderDayNavigation(daysData);
  renderItinerary(daysData);
}

function toggleDevMode() {
  setDevMode(!isDevMode);
  localStorage.setItem('jp_itin_devmode', isDevMode ? '1':'');
}

async function savePlanToServer() {
  alert('‚ö†Ô∏è –í –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–º —Ä–µ–∂–∏–º–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.');
}

async function saveHTMLToFile() {
  try {
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
    window.embeddedData = tripDataRaw;
    const htmlContent = document.documentElement.outerHTML;
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'index.html';
    a.click();
    URL.revokeObjectURL(url);
    alert('‚úÖ HTML —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ –Ω–∞ GitHub.');
  } catch (error) {
    alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  isDevMode = !!localStorage.getItem('jp_itin_devmode');
  loadData().then(data => {
    if (!data) {
      console.error('–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
      return;
    }
    tripDataRaw = data;
    if (!tripDataRaw.days) tripDataRaw.days = [];
    tripDataRaw.days = tripDataRaw.days.map(d => ({
      ...d,
      expenses: coerceExpense(d.expenses)
    }));
    daysData = tripDataRaw.days;
    console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –¥–Ω–µ–π:', daysData.length);
    setDevMode(isDevMode);
    computeAndRenderTotals();
  }).catch(err => {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', err);
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ö–æ—Ç—è –±—ã –ø—É—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    tripDataRaw = {
      "dates": "16‚Äì29 –Ω–æ—è–±—Ä—è 2025",
      "budget": "~180 000 ‚ÇΩ",
      "author": "–í–∞—à–µ –ò–º—è",
      "header": "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –Ø–ø–æ–Ω–∏—é",
      "days": []
    };
    daysData = [];
    setDevMode(isDevMode);
    computeAndRenderTotals();
  });
});

function renderTripInfo(data) {
  if (!data) return;
  const dates = document.getElementById('trip-dates');
  const budget = document.getElementById('budget');
  const author = document.getElementById('author-name');
  const header = document.querySelector('header h1');
  if (dates) dates.textContent = data.dates || '';
  if (budget) budget.textContent = data.budget || '';
  if (author) {
    author.textContent = data.author || '–í–∞—à–µ –ò–º—è';
    author.contentEditable = isDevMode;
    author.oninput = () => { tripDataRaw.author = author.textContent; saveData(tripDataRaw); };
  }
  if (header) {
    header.contentEditable = isDevMode;
    header.oninput = () => { tripDataRaw.header = header.textContent; saveData(tripDataRaw); };
    if (tripDataRaw.header) header.textContent = tripDataRaw.header;
  }
  if (isDevMode) {
    if (dates) {
      dates.contentEditable = true;
      dates.oninput = () => { tripDataRaw.dates = dates.textContent; saveData(tripDataRaw); };
    }
    if (budget) {
      budget.contentEditable = true;
      budget.oninput = () => { tripDataRaw.budget = budget.textContent; saveData(tripDataRaw); };
    }
  } else {
    if (dates) dates.contentEditable = false;
    if (budget) budget.contentEditable = false;
  }
}

function renderDayNavigation(days) {
  const nav = document.getElementById('day-nav');
  if (!nav) return;
  nav.innerHTML = '';
  if (!days || !Array.isArray(days) || days.length === 0) {
    return;
  }
  days.forEach((day, idx) => {
    const btn = document.createElement('button');
    btn.textContent = `–î–µ–Ω—å ${idx + 1}`;
    btn.className = 'day-nav-btn';
    btn.dataset.dayIdx = idx;
    btn.onclick = () => {
      setActiveDay(idx);
      scrollToDay(day.id);
    };
    nav.appendChild(btn);
  });
  if (days.length > 0) setActiveDay(0);
}

function setActiveDay(idx, skipMap) {
  const nav = document.getElementById('day-nav');
  if (!nav) return;
  const buttons = nav.querySelectorAll('button');
  buttons.forEach(b => b.classList.remove('active'));
  if (buttons[idx]) buttons[idx].classList.add('active');
}

window.addEventListener('scroll', () => {
  const daySections = Array.from(document.querySelectorAll('.day'));
  if (daySections.length === 0) return;
  let minDiff = Infinity, idxToActivate = 0;
  const scrollY = window.scrollY + 70;
  daySections.forEach((sec, i) => {
    const diff = Math.abs(sec.offsetTop - scrollY);
    if (diff < minDiff) {
      minDiff = diff;
      idxToActivate = i;
    }
  });
  setActiveDay(idxToActivate, true);
});

window.focusEventOnMap = function(idx) {
  const timelineEvents = document.querySelectorAll('.timeline-list .timeline-event');
  timelineEvents.forEach(ev => ev.classList.remove('selected'));
  if (timelineEvents[idx]) {
    timelineEvents[idx].classList.add('selected');
    if (window.innerWidth < 800) {
      const section = timelineEvents[idx].closest('.day');
      if (section) section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }
}

function scrollToDay(dayId) {
  const section = document.getElementById(`day-${dayId}`);
  if (section) {
    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

function renderItinerary(days) {
  const root = document.getElementById('itinerary');
  if (!root) {
    console.error('–≠–ª–µ–º–µ–Ω—Ç #itinerary –Ω–µ –Ω–∞–π–¥–µ–Ω');
    return;
  }
  if (!days || !Array.isArray(days)) {
    console.error('days –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:', days);
    root.innerHTML = '<p style="color: #ff3399; padding: 20px; text-align: center;">–î–Ω–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –í–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ –¥–Ω–∏.</p>';
    return;
  }
  if (days.length === 0) {
    root.innerHTML = '<p style="color: #ff3399; padding: 20px; text-align: center;">–î–Ω–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞" –∏ –¥–æ–±–∞–≤—å—Ç–µ –¥–Ω–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.</p>';
    return;
  }
  root.innerHTML = '';
  days.forEach((day, idx) => {
    const daySection = document.createElement('section');
    daySection.className = 'day';
    daySection.id = `day-${day.id}`;
    daySection.setAttribute('data-day-idx', idx);

    const titleBlock = isDevMode
      ? `<div class="day-notes" contenteditable="true" data-df="title" data-day-idx="${idx}">${day.title||''}</div>`
      : `<div class="day-notes"><strong>${day.title||''}</strong></div>`;
    const notesBlock = isDevMode
      ? `<div class="dev-daynotes" contenteditable="true" data-df="notes" data-day-idx="${idx}">${day.notes||''}</div>`
      : `<div class="dev-daynotes">${day.notes||''}</div>`;

    const expVal = coerceExpense(day.expenses);
    const currency = day.currency || 'RUB';
    const currencySymbol = currency === 'JPY' ? '¬•' : '‚ÇΩ';
    const jpyEquivalent = currency === 'JPY' ? ` (~${formatRub(Math.round(expVal * RATE_JPY_TO_RUB))} ‚ÇΩ –ø–æ –∫—É—Ä—Å—É ${RATE_JPY_TO_RUB})` : '';
    
    const expensesBlock = isDevMode
      ? `<div class="day-summary">–ò—Ç–æ–≥–æ–≤—ã–µ —Ç—Ä–∞—Ç—ã: <input class="editable-input" type="number" min="0" step="100" value="${expVal}" data-expenses="${idx}" /> <select class="editable-input" data-currency="${idx}" style="width:80px;margin-left:4px;">
          <option value="RUB" ${currency === 'RUB' ? 'selected' : ''}>‚ÇΩ (—Ä—É–±)</option>
          <option value="JPY" ${currency === 'JPY' ? 'selected' : ''}>¬• (–∏–µ–Ω—ã)</option>
        </select></div>`
      : `<div class="day-summary">–ò—Ç–æ–≥–æ–≤—ã–µ —Ç—Ä–∞—Ç—ã: <b>${formatRub(expVal)} ${currencySymbol}${jpyEquivalent}</b></div>`;

    let mediaBlock = '';
    if (isDevMode) {
      mediaBlock = `<input type="file" accept="image/*" class="photo-upload" data-day="${day.id}" data-day-idx="${idx}" />`+(day.photo ? `<img src="${day.photo}" class="uploaded-photo"><button class="dev-photo-delete" data-day="${day.id}" data-day-idx="${idx}">–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ</button>`:'');
    } else if (day.photo) {
      mediaBlock = `<img src="${day.photo}" alt="photo" class="uploaded-photo">`;
    }

    let timelineHtml = '';
    day.timeline.forEach((ev, eidx) => {
      if (!isDevMode) {
        const mapsUrl = ev.location && ev.location.mapsUrl ? ev.location.mapsUrl : null;
        const handlerStr = mapsUrl ?
          `event.stopPropagation(); if(window._tlClickHandler) window._tlClickHandler(${eidx}, '${mapsUrl.replace(/'/g, "\\'")}');` :
          `event.stopPropagation(); if(window._tlClickHandler) window._tlClickHandler(${eidx}, null);`;
        timelineHtml += `
<li class="timeline-event" onclick="${handlerStr}">
  <time>${ev.time||''}</time> ${ev.title||''}
  <div class="ev-note">${ev.note || ''}</div>
</li>`;
      } else {
        timelineHtml += `
<li class="timeline-event editing" data-eidx="${eidx}" data-day-idx="${idx}">
  <input class="editable-input" type="text" value="${ev.time||''}" data-ef="time" size="6" placeholder="–í—Ä–µ–º—è">
  <input class="editable-input" type="text" value="${ev.title||''}" data-ef="title" size="18" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
  <input class="editable-input" type="text" value="${(ev.location&&ev.location.mapsUrl)||''}" data-ef="mapsUrl" size="28" placeholder="Google Maps URL (–æ–ø—Ü.)">
  <input class="editable-input" type="text" value="${ev.note||''}" data-ef="note" size="28" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ">
  <button class="dev-photo-delete" data-del-evt="${eidx}" data-day-idx="${idx}">‚Äì</button>
</li>`;
      }
    });
    if (isDevMode) {
      timelineHtml += `<button class="photo-upload" data-add-evt="${day.id}" data-day-idx="${idx}">+ –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>`;
    }

    daySection.innerHTML = `
      <h2 contenteditable="${isDevMode}" data-df="date" data-day-idx="${idx}">–î–µ–Ω—å ${idx+1}: ${day.date||''}</h2>
      ${titleBlock}
      ${notesBlock}
      ${expensesBlock}
      <div class="day-content">
        <div class="timeline-col">
          <ul class="timeline-list">${timelineHtml}</ul>
        </div>
        ${mediaBlock ? `<div class="map-col">${mediaBlock}</div>` : ''}
      </div>
    `;
    root.appendChild(daySection);
  });
  if (isDevMode) addDevmodeHandlers();
  else window._tlClickHandler = (idx, url) => { 
    if (window.focusEventOnMap) window.focusEventOnMap(idx); 
    if(url) window.open(url,'_blank'); 
  };
  computeAndRenderTotals();
}

function addDevmodeHandlers() {
  document.querySelectorAll('[contenteditable][data-df][data-day-idx]').forEach(el => {
    const dayIdx = Number(el.getAttribute('data-day-idx'));
    if (isNaN(dayIdx) || dayIdx < 0 || dayIdx >= daysData.length) return;
    el.oninput = () => {
      const key = el.getAttribute('data-df');
      const val = el.innerText.trim();
      if (key === 'date') {
        daysData[dayIdx].date = val.replace(/^–î–µ–Ω—å\s+\d+:\s*/i,'');
      } else {
        daysData[dayIdx][key] = val;
      }
      saveData(tripDataRaw);
      computeAndRenderTotals();
    };
  });
  
  document.querySelectorAll('input[data-expenses]').forEach(inp => {
    const idx = Number(inp.getAttribute('data-expenses'));
    if (isNaN(idx) || idx < 0 || idx >= daysData.length) return;
    inp.oninput = () => {
      daysData[idx].expenses = coerceExpense(inp.value);
      saveData(tripDataRaw);
      computeAndRenderTotals();
    };
  });
  
  document.querySelectorAll('select[data-currency]').forEach(sel => {
    const idx = Number(sel.getAttribute('data-currency'));
    if (isNaN(idx) || idx < 0 || idx >= daysData.length) return;
    sel.onchange = () => {
      daysData[idx].currency = sel.value;
      saveData(tripDataRaw);
      renderItinerary(daysData);
      computeAndRenderTotals();
    };
  });
  
  document.querySelectorAll('.timeline-event.editing[data-day-idx]').forEach((li) => {
    const dayIdx = Number(li.getAttribute('data-day-idx'));
    const eidx = Number(li.getAttribute('data-eidx'));
    if (isNaN(dayIdx) || dayIdx < 0 || dayIdx >= daysData.length) return;
    if (isNaN(eidx) || eidx < 0 || eidx >= (daysData[dayIdx].timeline || []).length) return;
    
    ['time','title','mapsUrl','note'].forEach(field => {
      const inp = li.querySelector(`[data-ef="${field}"]`);
      if (!inp) return;
      inp.oninput = () => {
        const val = inp.value;
        if (field === 'mapsUrl') {
          if (!daysData[dayIdx].timeline[eidx].location) daysData[dayIdx].timeline[eidx].location = {};
          daysData[dayIdx].timeline[eidx].location.mapsUrl = val;
        } else {
          daysData[dayIdx].timeline[eidx][field] = val;
        }
        saveData(tripDataRaw);
      };
    });
    
    const del = li.querySelector('[data-del-evt]');
    if (del) del.onclick = () => {
      daysData[dayIdx].timeline.splice(eidx, 1);
      saveData(tripDataRaw);
      renderItinerary(daysData);
      computeAndRenderTotals();
    };
  });
  
  document.querySelectorAll('[data-add-evt][data-day-idx]').forEach(btn => {
    const dayIdx = Number(btn.getAttribute('data-day-idx'));
    if (isNaN(dayIdx) || dayIdx < 0 || dayIdx >= daysData.length) return;
    btn.onclick = () => {
      daysData[dayIdx].timeline.push({time:'',title:'',note:''});
      saveData(tripDataRaw);
      renderItinerary(daysData);
      computeAndRenderTotals();
    };
  });
  
  document.querySelectorAll('input.photo-upload[type="file"][data-day-idx]').forEach(inp => {
    const dayIdx = Number(inp.getAttribute('data-day-idx'));
    if (isNaN(dayIdx) || dayIdx < 0 || dayIdx >= daysData.length) return;
    inp.onchange = (e) => {
      const file = inp.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        daysData[dayIdx].photo = reader.result;
        saveData(tripDataRaw);
        renderItinerary(daysData);
        computeAndRenderTotals();
      };
      reader.readAsDataURL(file);
    };
  });
  
  document.querySelectorAll('button.dev-photo-delete[data-day-idx]').forEach(btn => {
    if (btn.hasAttribute('data-day')) {
      const dayIdx = Number(btn.getAttribute('data-day-idx'));
      if (isNaN(dayIdx) || dayIdx < 0 || dayIdx >= daysData.length) return;
      btn.onclick = () => {
        delete daysData[dayIdx].photo;
        saveData(tripDataRaw);
        renderItinerary(daysData);
        computeAndRenderTotals();
    };
    }
  });
}
  </script>
</body>
</html>
